jQuery(function(d){var n=function(){var k=("https:"==location.protocol?"https:":"http:")+"//formoid.net/api/push",b=function(){var a=(/MSIE (\d+)\./.exec(navigator.userAgent)||[0,0])[1];return 8==a||9==a&&"file:"!=location.protocol?function(a,c){var b=new XDomainRequest,h=d.Deferred();return b.open(c.type,a),b.onload=function(){h.resolve(this.responseText)},b.onerror=function(){h.reject()},b.send(c.data),h}:(d.support.cors=!0,d.ajax)}(),e=function(a,b){return a="__"+a+"__",b.length?(this[a]=b[0],
this):this[a]},g=function(a,b,c){return d.each(c,function(d,c){a[c]=function(){return b[c].apply(b,arguments)}}),a},f=function(a){a=a||{};this.__email__=a.email||"";this.__title__=a.title||"";this.__data__=a.data||[]};return f.prototype.email=function(a){return e.call(this,"email",arguments)},f.prototype.title=function(a){return e.call(this,"title",arguments)},f.prototype.data=function(a){return e.call(this,"data",arguments)},f.prototype.send=function(a,e){var c=g(d.Deferred(),this,["email","title",
"data","send"]);return e&&(e.call(this,c),"pending"!=c.state())?c:(b(k,{type:"POST",data:JSON.stringify({email:this.__email__,form:{title:this.__title__,data:arguments.length?a:this.__data__}})}).done(function(a){try{var b=JSON.parse(a);b.error?c.reject(b.error):c.resolve(b.response)}catch(d){c.reject("Incorrect server response.")}}).fail(function(){var a;a="Failed to query the server. "+("onLine"in navigator&&!navigator.onLine?"No connection to the Internet.":"Check the connection and try again.");
c.reject(a)}),c)},{Form:function(a){return new f(a)}}}();d('[data-form-type="formoid"]').each(function(){var k,b=d(this),e=b.is("form")?b:b.find("form"),g=b.find("[data-form-alert]"),f=b.is("[data-form-title]")?b:b.find("[data-form-title]"),a=b.find('[type="submit"]'),m=g.attr("data-success")||g.find("[data-form-alert-success]").html();a.html('<span class="btn-text">'+a.html()+'</span><i class="btn-loader"></i>').click(function(){e.addClass("form-active")});e.submit(function(c){if(c.preventDefault(),
e.addClass("form-active"),!a.hasClass("btn-loading")){var l=!0,h=[];k=k||n.Form({email:b.find("[data-form-email]").val(),title:f.attr("data-form-title")||f.text()});g.html("");b.find("[data-form-field]").each(function(){var a;if(this.checkValidity)a=this.checkValidity();else{var b=!0;a=d(this).val();var c=d(this).attr("type");a=(a?b=!("email"===c&&!/^([^@]+?)@(([a-z0-9]-*)*[a-z0-9]+\.)+([a-z0-9]+)$/i.test(a)):d(this).attr("required")&&(b=!1),d(this)[(b?"remove":"add")+"Class"]("form-invalid"),b)}a||
(l=!1);h.push([d(this).attr("data-form-field")||d(this).attr("name"),d(this).val()])});l&&(a.addClass("btn-loading"),k.send(h).done(function(a){e.removeClass("form-active");b.find("[data-form-field]").val("");g.append(d('<div class="alert alert-success text-center"/>').text(m||a))}).fail(function(a){g.append(d('<div class="alert alert-danger text-center"/>').text(a))}).always(function(){a.removeClass("btn-loading")}))}})})});
